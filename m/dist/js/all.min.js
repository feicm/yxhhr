$(function(){"use strict";var e={REMAINING_TIME:$.cookie("REMAINING_TIME")-0||18e5,POST_URL:"http://act.17173.com/2015/05/yxhhr0709/index.php",EXPIRES:1,STARTTIME:$.cookie("STARTTIME")-0||0,inter:null,indexUrl:"index.html",papers:{},countRightAnswer:0,questionHtmlArr:[],questionWrap:null,answerInfo:{name:null,qq:null,phone:null,email:null,questionInfo:{paperId:null,questionsId:$.cookie("QUESTIONS")?$.cookie("QUESTIONS").split("---"):0||[],answers:{}},takeTime:0,score:0},init:function(){var e=this,t=(new Date).getTime();"#debug"===location.hash&&e.clearCookie();var n=e.getRandomPaperId(4);$.cookie("REMAINING_TIME")&&$.cookie("PAPERID")?($.cookie("NAME")&&$("#name").val(decodeURI($.cookie("NAME"))),$.cookie("PHONE")&&$("#phone").val($.cookie("PHONE")),$.cookie("EMAIL")&&$("#email").val($.cookie("EMAIL")),$.cookie("QQ")&&$("#qq").val($.cookie("QQ")),$.cookie("STARTTIME")&&(e.REMAINING_TIME=18e5-t+($.cookie("STARTTIME")-0)),e.renderQuestionsList($.cookie("PAPERID")),$("#info").hide(),$("#qArea").show(),e.bindEvent(!0),$("#start").off("click")):(e.renderQuestionsList(n),e.bindEvent())},bindEvent:function(e){var t=this;t.inter&&clearInterval(t.inter),e&&(t.inter=setInterval(function(){t.countDown()},1e3)),e&&(window.onbeforeunload=function(e){e=e||window.event,t.REMAINING_TIME>0&&t.storeAnswerInfo()}),$("#start").off("click"),$("#submit").off("click"),$("#start").on("click",function(e){t.startListener(e,$(this))}),$("#submit").on("click",function(e){t.submitListener(e,$(this))})},startListener:function(e,n){var i=this,o=$("#name").val(),a=$("#phone").val(),r=$("#email").val(),c=$("#qq").val();return e.preventDefault(),n.off("click"),"block"===$("#qArea").css("display")?!1:(i.initStartTime(),void(""!==o&&/^([\u4e00-\u9fa5]){2,7}$/.test(o)?""!==a&&/^(13[0-9]|15[0|1|2|3|5|6|7|8|9]|18[0-9]|17[6|7|8])\d{8}$/.test(a)?""!==r&&/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(r)?""!==c&&/^\d{5,10}$/.test(c)?(i.bindEvent(!0),$("#info").hide(),$.ajax({url:i.POST_URL+"?do=updateUserInfo",data:{name:encodeURI(o),email:r,mobile:a,qq:c},type:"post",dataType:"json"}).done(function(e){return i.answerInfo.name=o,i.answerInfo.phone=a,i.answerInfo.email=r,i.answerInfo.qq=c,$.cookie("NAME",o,{expires:i.EXPIRES}),$.cookie("PHONE",a,{expires:i.EXPIRES}),$.cookie("EMAIL",r,{expires:i.EXPIRES}),$.cookie("QQ",c,{expires:i.EXPIRES}),3===e.status?(new t("alert",{img:"http://ue1.17173cdn.com/a/news/p/2015/m/img/img3-p.png",title:"您的ip地址已经完成答卷，<br/>不能重复答题！",okText:"返回制作人首页",okCallback:function(){location.href=i.indexUrl}}),n.on("click",function(e){i.startListener(e,$(this))}),!1):void $("#qArea").show()}).fail(function(e){n.on("click",function(e){i.startListener(e,$(this))})})):(i.msgBox("alert",{title:"抱歉！",content:"请输入正确QQ号码！"}),n.on("click",function(e){i.startListener(e,$(this))})):(i.msgBox("alert",{title:"抱歉！",content:"请输入正确邮箱！"}),n.on("click",function(e){i.startListener(e,$(this))})):(i.msgBox("alert",{title:"抱歉！",content:"请输入正确手机号码！"}),n.on("click",function(e){i.startListener(e,$(this))})):(i.msgBox("alert",{title:"抱歉！",content:"请输入正确姓名！"}),n.on("click",function(e){i.startListener(e,$(this))}))))},submitListener:function(e,n){var i=this,o=i.getAnswerNum();i.storeAnswerInfo(),e.preventDefault(),n.off("click");var a,r;a=i.countScore(),r=i.getTakeTime(),i.answerInfo.takeTime=r,i.answerInfo.score=a,$("#qArea").hide(),40===o||i.REMAINING_TIME<=0?(a>=85?new t("alert",{img:"http://ue1.17173cdn.com/a/news/p/2015/m/img/img1-p.png",title:'<div class="tit">答题结束，您得到了<div class="num">'+a+"分</div></div>",text:"我们将会把您的资料推荐给知名的游戏厂商，由厂商安排人员回访，谢谢！",okText:"返回制作人首页",okCallback:function(){location.href=i.indexUrl}}):new t("alert",{img:"http://ue1.17173cdn.com/a/news/p/2015/m/img/img2-p.png",title:'<div class="tit">答题结束，您得到了<div class="num">'+a+"分</div></div>",text:"抱歉，您的知识积累暂时还无法达到游戏制作人的要求，感谢您的参与，谢谢！",okText:"返回制作人首页",okCallback:function(){location.href=i.indexUrl}}),i.submitAnswers()):new t("confirm",{title:"您还有"+(40-o)+"题未回答，是否确认提交?",okText:"确认提交",cancelText:"继续答题",okCallback:function(){i.submitAnswers(),a>=85?new t("alert",{img:"http://ue1.17173cdn.com/a/news/p/2015/m/img/img1-p.png",title:'<div class="tit">答题结束，您得到了<div class="num">'+a+"分</div></div>",text:"我们将会把您的资料推荐给知名的游戏厂商，由厂商安排人员回访，谢谢！",okText:"返回制作人首页",okCallback:function(){location.href=i.indexUrl}}):new t("alert",{img:"http://ue1.17173cdn.com/a/news/p/2015/m/img/img2-p.png",title:'<div class="tit">答题结束，您得到了<div class="num">'+a+"分</div></div>",text:"抱歉，您的知识积累暂时还无法达到游戏制作人的要求，感谢您的参与，谢谢！",okText:"返回制作人首页",okCallback:function(){location.href=i.indexUrl}})},cancelCallback:function(){n.on("click",function(e){i.submitListener(e,$(this))}),$("#qArea").show()}})},storeAnswerInfo:function(){var e,t=this;$.cookie("PAPERID",t.answerInfo.questionInfo.paperId,{expires:t.EXPIRES}),$.cookie("QUESTIONS")||$.cookie("QUESTIONS",t.answerInfo.questionInfo.questionsId.join("---"),{expires:t.EXPIRES}),e=t.getAnswerNum(),e&&$.cookie("ANSWERS",JSON.stringify(t.answerInfo.questionInfo.answers),{expires:t.EXPIRES})},getAnswerNum:function(){var e=this,t=e.questionWrap,n=0,i=0,o="",a="";return t.find(".item").each(function(t){var r=t+1;o=$(this).data("questionid"),$(this).find("input").each(function(){var t=$(this);return t.prop("checked")?(a=t.val(),1===t.data("goal")&&n++,i++,e.answerInfo.questionInfo.answers[o]={showNum:r,select:a,isSelectTrue:t.data("goal")?!0:!1},!1):void 0})}),e.countRightAnswer=n,i},countScore:function(){var e=this;return 2.5*(e.countRightAnswer-0)},getTakeTime:function(){var e=18e5-($.cookie("REMAINING_TIME")-0),t=Math.floor(e/1e3/60%60),n=Math.floor(e/1e3%60);return 10>t?t="0"+t:t,10>n?n="0"+n:n,t+":"+n},submitAnswers:function(){var e=this;$.ajax({url:e.POST_URL+"?do=save",data:{result:e.answerInfo.questionInfo.answers,time:e.answerInfo.takeTime,score:e.answerInfo.score,paperid:e.answerInfo.questionInfo.paperId},type:"post",dataType:"json"}).done(function(t){$("#submit").on("click",function(t){e.answeredTips()})}).fail(function(t){e.REMAINING_TIME>0?$("#submit").on("click",function(t){e.submitListener(t,$(this))}):$("#submit").on("click",function(t){e.answeredTips()})})},answeredTips:function(){var e=this;e.msgBox("alert",{title:"抱歉！",content:"你已经参与过答题，感谢您的参与，谢谢！"})},countDown:function(){var e=this,n=0,i=0,o=0;e.REMAINING_TIME>=0?(n=Math.floor(e.REMAINING_TIME/1e3/60%60),i=Math.floor(e.REMAINING_TIME/1e3%60),10>i?i="0"+i:i):(o=e.countScore(),o>=85?new t("alert",{img:"http://ue1.17173cdn.com/a/news/p/2015/m/img/img1-p.png",title:'<div class="tit">时间到，答题结束，您得到了<div class="num">'+o+"分</div></div>",text:"我们将会把您的资料推荐给知名的游戏厂商，由厂商安排人员回访，谢谢！",okText:"返回制作人首页",okCallback:function(){location.href=e.indexUrl}}):new t("alert",{img:"http://ue1.17173cdn.com/a/news/p/2015/m/img/img2-p.png",title:'<div class="tit">时间到，答题结束，您得到了<div class="num">'+o+"分</div></div>",text:"抱歉，您的知识积累暂时还无法达到游戏制作人的要求，感谢您的参与，谢谢！",okText:"返回制作人首页",okCallback:function(){location.href=e.indexUrl}}),clearInterval(e.inter,1e3),e.REMAINING_TIME=0,e.answerInfo.takeTime=e.getTakeTime(),e.answerInfo.score=o,e.submitAnswers(),$("#submit").off("click"),n=i="00"),$("#t_m").text(n+":"),$("#t_s").text(i),e.REMAINING_TIME-=1e3,$.cookie("REMAINING_TIME",e.REMAINING_TIME,{expires:e.EXPIRES})},resortArr:function(e){if(!e.length)return!1;if(!e instanceof Array)return!1;var t=[],n="";for(n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t.sort(function(){return.5-Math.random()}),t},renderQuestionsList:function(e){var t=this,n="",i="",o="";$(".list-question").each(function(a){var r=$(this);if(n=r.attr("data-paperid"),n===e){if($.cookie("PAPERID")){i=r.find(".item"),o=$.cookie("QUESTIONS").split("---");for(var c=0;c<o.length;c++){var s=i[o[c].substr(1)-0-1];t.questionHtmlArr.push($("<p>").append($(s).clone()).html())}return t.answerInfo.questionInfo.paperId=$.cookie("PAPERID"),t.questionWrap=r,t.show(r),!1}return r.find(".item").each(function(e){t.questionHtmlArr.push($("<p>").append($(this).clone()).html())}),t.questionHtmlArr=t.resortArr(t.questionHtmlArr),r.html(""),t.questionWrap=r,t.show(r),t.answerInfo.questionInfo.paperId=e,!1}})},fillAnswers:function(){var e="",t="",n="",i=JSON.parse($.cookie("ANSWERS"));$(".list-question").each(function(o){var a=$(this);n=a.attr("data-paperid"),n===$.cookie("PAPERID")&&a.find(".item").each(function(n){e=$(this).data("questionid"),void 0!==i[e]&&(t=i[e].select,$(this).find("input").each(function(e){var n=$(this);n.val()===t?n.attr("checked","checked"):n.attr("checked",!1)}))})})},show:function(e){for(var t=this,n="",i="",o="",a="",r="",c=0;c<t.questionHtmlArr.length;c++)r=10>c+1?"0"+(c+1):c+1,o=$(t.questionHtmlArr[c]),o.find(".num").text(r),a=$("<p>").append(o.clone()).html(),n+=a,i=o.data("questionid"),t.answerInfo.questionInfo.questionsId.push(i),t.questionHtmlArr[c]=a;e.html(n),e.show(),$.cookie("ANSWERS")&&t.fillAnswers()},initStartTime:function(){var e=this;e.STARTTIME=(new Date).getTime(),$.cookie("STARTTIME",e.STARTTIME,{expires:e.EXPIRES})},getRandomPaperId:function(e){return"p"+parseInt(Math.random()*e+1,0)},loadPandora:function(e){if($.isPlainObject(window.pandora))e&&$.isFunction(e)&&e();else{var t=document,n=t.createElement("script");n.type="text/javascript",n.async=!0,n.src="http://ue.17173cdn.com/a/lib/pandora.js",n.onload=n.onreadystatechange=function(){n.readyState&&"loaded"!=n.readyState&&"complete"!=n.readyState||(n.onreadystatechange=n.onload=null,e&&$.isFunction(e)&&e())},document.body.appendChild(n)}},msgBox:function(e,t){var n=this,i=t;i&&n.loadPandora(function(){pandora.use([e],function(e){new e({importStyle:!0,title:i.title,content:i.content,width:"550px"})})})},clearCookie:function(){$.cookie("REMAINING_TIME",""),$.cookie("QUESTIONS",""),$.cookie("PAPERID",""),$.cookie("STARTTIME",""),$.cookie("NAME",""),$.cookie("PHONE",""),$.cookie("EMAIL",""),$.cookie("QQ",""),$.cookie("ANSWERS","")}};e.init();var t=function(e,t){var n={img:"",title:"提示",text:"",okText:"确定",cancelText:"取消",okCallback:null,cancelCallback:null};this.type=e||"alert",this.opts=$.extend(n,t),this.init()};t.prototype={constructor:t,current:null,init:function(){this.render(),this.bindEvent()},render:function(){var e=this,t=e.getHtml();e.current=$(t),$("body").append(e.current)},bindEvent:function(){var e,t=this,n=t.opts;t.current.on("click","a",function(i){i.preventDefault(),e=$(this).data("action"),n.okCallback&&$.isFunction(n.okCallback)&&"ok"===e&&n.okCallback(),n.cancelCallback&&$.isFunction(n.cancelCallback)&&"cancel"===e&&n.cancelCallback(),t.destory()})},getHtml:function(){var e=this,t="",n=e.opts,i=n.img?'<div class="pic-box"><img src="'+n.img+'" alt=""></div>':"";switch(e.type){case"alert":t='<div class="pn pn-tip pn-tip2">	<div class="tip-box">'+i+'		<h1 class="tit-box">			<div class="tit">'+n.title+'</div>		</h1>		<div class="txt">'+n.text+'</div>	</div>	<a href="#" data-action="ok" class="comm-btn">'+n.okText+"</a></div>";break;case"confirm":t='<div class="pn pn-tip pn-tip1">	<h1 class="tip-tit">'+n.title+'</h1>			<a class="comm-btn comm-btn-ex2" data-action="cancel">'+n.cancelText+'</a>	<a class="comm-btn" data-action="ok">'+n.okText+"</a></div>"}return t},destory:function(){this.current.remove()}}}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function t(e){return c.raw?e:encodeURIComponent(e)}function n(e){return c.raw?e:decodeURIComponent(e)}function i(e){return t(c.json?JSON.stringify(e):String(e))}function o(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(r," ")),c.json?JSON.parse(e):e}catch(t){}}function a(t,n){var i=c.raw?t:o(t);return e.isFunction(n)?n(i):i}var r=/\+/g,c=e.cookie=function(o,r,s){if(void 0!==r&&!e.isFunction(r)){if(s=e.extend({},c.defaults,s),"number"==typeof s.expires){var l=s.expires,u=s.expires=new Date;u.setTime(+u+864e5*l)}return document.cookie=[t(o),"=",i(r),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}for(var d=o?void 0:{},f=document.cookie?document.cookie.split("; "):[],p=0,m=f.length;m>p;p++){var I=f[p].split("="),h=n(I.shift()),k=I.join("=");if(o&&o===h){d=a(k,r);break}o||void 0===(k=a(k))||(d[h]=k)}return d};c.defaults={},e.removeCookie=function(t,n){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}});