$(function(){"use strict";var e={REMAINING_TIME:$.cookie("REMAINING_TIME")-0||18e5,POST_URL:"http://act.17173.com/2015/05/yxhhr0709/index.php",EXPIRES:1,STARTTIME:$.cookie("STARTTIME")-0||0,inter:null,papers:{},countRightAnswer:0,questionHtmlArr:[],questionWrap:null,answerInfo:{name:null,qq:null,phone:null,email:null,questionInfo:{paperId:null,questionsId:$.cookie("QUESTIONS")?$.cookie("QUESTIONS").split("---"):0||[],answers:{}},takeTime:0,score:0},init:function(){var e=this,t=(new Date).getTime(),n=e.getRandomPaperId(4);$.cookie("REMAINING_TIME")&&$.cookie("PAPERID")?($.cookie("NAME")&&$("#name").val(decodeURI($.cookie("NAME"))),$.cookie("PHONE")&&$("#phone").val($.cookie("PHONE")),$.cookie("EMAIL")&&$("#email").val($.cookie("EMAIL")),$.cookie("QQ")&&$("#qq").val($.cookie("QQ")),$.cookie("STARTTIME")&&(e.REMAINING_TIME=18e5-t+($.cookie("STARTTIME")-0)),e.renderQuestionsList($.cookie("PAPERID")),$("#qArea").show(),e.bindEvent(!0),$("#start").off("click")):(e.renderQuestionsList(n),e.bindEvent())},bindEvent:function(e){var t=this;t.inter&&clearInterval(t.inter),e&&(t.inter=setInterval(function(){t.countDown()},1e3)),e&&(window.onbeforeunload=function(e){e=e||window.event,t.REMAINING_TIME>0&&t.storeAnswerInfo()}),$("#start").off("click"),$("#submit").off("click"),$("#start").on("click",function(e){t.startListener(e,$(this))}),$("#submit").on("click",function(e){t.submitListener(e,$(this))})},startListener:function(e,t){var n=this,o=$("#name").val(),i=$("#phone").val(),r=$("#email").val(),s=$("#qq").val();return e.preventDefault(),t.off("click"),"block"===$("#qArea").css("display")?!1:(n.initStartTime(),void(""!==o&&/^([\u4e00-\u9fa5]){2,7}$/.test(o)?""!==i&&/^(13[0-9]|15[0|1|2|3|5|6|7|8|9]|18[0-9]|17[6|7|8])\d{8}$/.test(i)?""!==r&&/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(r)?""!==s&&/^\d{5,10}$/.test(s)?(n.bindEvent(!0),$.ajax({url:n.POST_URL+"?do=updateUserInfo",data:{name:encodeURI(o),email:r,mobile:i,qq:s},type:"post",dataType:"json"}).done(function(e){return n.answerInfo.name=o,n.answerInfo.phone=i,n.answerInfo.email=r,n.answerInfo.qq=s,$.cookie("NAME",o,{expires:n.EXPIRES}),$.cookie("PHONE",i,{expires:n.EXPIRES}),$.cookie("EMAIL",r,{expires:n.EXPIRES}),$.cookie("QQ",s,{expires:n.EXPIRES}),3===e.status?(n.msgBox("alert",{title:"抱歉！",content:"您已经参加过答题，感谢您的支持！"}),t.on("click",function(e){n.startListener(e,$(this))}),!1):void $("#qArea").show()}).fail(function(e){t.on("click",function(e){n.startListener(e,$(this))})})):(n.msgBox("alert",{title:"抱歉！",content:"请输入正确QQ号码！"}),t.on("click",function(e){n.startListener(e,$(this))})):(n.msgBox("alert",{title:"抱歉！",content:"请输入正确邮箱！"}),t.on("click",function(e){n.startListener(e,$(this))})):(n.msgBox("alert",{title:"抱歉！",content:"请输入正确手机号码！"}),t.on("click",function(e){n.startListener(e,$(this))})):(n.msgBox("alert",{title:"抱歉！",content:"请输入正确姓名！"}),t.on("click",function(e){n.startListener(e,$(this))}))))},submitListener:function(e,t){var n=this,o=n.getAnswerNum();n.storeAnswerInfo(),e.preventDefault(),t.off("click");var i,r;i=n.countScore(),r=n.getTakeTime(),n.answerInfo.takeTime=r,n.answerInfo.score=i,40===o||n.REMAINING_TIME<=0?(i>=85?n.msgBox("alert",{title:'答题结束，您得到了<b style="color:red;">'+i+"</b>分,",content:"我们将会把您的资料推荐给知名的游戏厂商，由厂商安排人员回访，谢谢！"}):n.msgBox("alert",{title:'答题结束，您得到了<b style="color:red;">'+i+"</b>分,",content:"抱歉，您的知识积累暂时还无法达到游戏制作人的要求，感谢您的参与，谢谢！"}),n.submitAnswers()):n.loadPandora(function(){pandora.use(["confirm"],function(e){new e({title:"您好！",content:"您还有"+(40-o)+"题未回答，是否确认提交?"}).on({submit:function(){n.submitAnswers(),i>=85?n.msgBox("alert",{title:'答题结束，您得到了<b style="color:red;">'+i+"</b>分,",content:"我们将会把您的资料推荐给知名的游戏厂商，由厂商安排人员回访，谢谢！"}):n.msgBox("alert",{title:'答题结束，您得到了<b style="color:red;">'+i+"</b>分,",content:"抱歉，您的知识积累暂时还无法达到游戏制作人的要求，感谢您的参与，谢谢！"})},cancel:function(){t.on("click",function(e){n.submitListener(e,$(this))})}})})})},storeAnswerInfo:function(){var e,t=this;$.cookie("PAPERID",t.answerInfo.questionInfo.paperId,{expires:t.EXPIRES}),$.cookie("QUESTIONS")||$.cookie("QUESTIONS",t.answerInfo.questionInfo.questionsId.join("---"),{expires:t.EXPIRES}),e=t.getAnswerNum(),e&&$.cookie("ANSWERS",JSON.stringify(t.answerInfo.questionInfo.answers),{expires:t.EXPIRES})},getAnswerNum:function(){var e=this,t=e.questionWrap,n=0,o=0,i="",r="";return t.find(".item").each(function(t){var s=t+1;i=$(this).data("questionid"),$(this).find("input").each(function(){var t=$(this);return t.prop("checked")?(r=t.val(),1===t.data("goal")&&n++,o++,e.answerInfo.questionInfo.answers[i]={showNum:s,select:r,isSelectTrue:t.data("goal")?!0:!1},!1):void 0})}),e.countRightAnswer=n,o},countScore:function(){var e=this;return 2.5*(e.countRightAnswer-0)},getTakeTime:function(){var e=18e5-($.cookie("REMAINING_TIME")-0),t=Math.floor(e/1e3/60%60),n=Math.floor(e/1e3%60);return 10>t?t="0"+t:t,10>n?n="0"+n:n,t+":"+n},submitAnswers:function(){var e=this;$.ajax({url:e.POST_URL+"?do=save",data:{result:e.answerInfo.questionInfo.answers,time:e.answerInfo.takeTime,score:e.answerInfo.score,paperid:e.answerInfo.questionInfo.paperId},type:"post",dataType:"json"}).done(function(t){$("#submit").on("click",function(t){e.answeredTips()})}).fail(function(t){e.REMAINING_TIME>0?$("#submit").on("click",function(t){e.submitListener(t,$(this))}):$("#submit").on("click",function(t){e.answeredTips()})})},answeredTips:function(){var e=this;e.msgBox("alert",{title:"抱歉！",content:"你已经参与过答题，感谢您的参与，谢谢！"})},countDown:function(){var e=this,t=0,n=0,o=0;e.REMAINING_TIME>=0?(t=Math.floor(e.REMAINING_TIME/1e3/60%60),n=Math.floor(e.REMAINING_TIME/1e3%60),10>n?n="0"+n:n):(o=e.countScore(),o>=85?e.msgBox("alert",{title:'时间到，答题结束，您得到了<b style="color:red;">'+o+"</b>分,",content:"我们将会把您的资料推荐给知名的游戏厂商，由厂商安排人员回访，谢谢！"}):e.msgBox("alert",{title:'时间到，答题结束，您得到了<b style="color:red;">'+o+"</b>分,",content:"抱歉，您的知识积累暂时还无法达到游戏制作人的要求，感谢您的参与，谢谢！"}),clearInterval(e.inter,1e3),e.REMAINING_TIME=0,e.answerInfo.takeTime=e.getTakeTime(),e.answerInfo.score=o,e.submitAnswers(),$("#submit").off("click"),t=n="00"),$("#t_m").text(t+":"),$("#t_s").text(n),e.REMAINING_TIME-=1e3,$.cookie("REMAINING_TIME",e.REMAINING_TIME,{expires:e.EXPIRES})},resortArr:function(e){if(!e.length)return!1;if(!e instanceof Array)return!1;var t=[],n="";for(n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t.sort(function(){return.5-Math.random()}),t},renderQuestionsList:function(e){var t=this,n="",o="",i="";$(".list-question").each(function(r){var s=$(this);if(n=s.attr("data-paperid"),n===e){if($.cookie("PAPERID")){o=s.find(".item"),i=$.cookie("QUESTIONS").split("---");for(var a=0;a<i.length;a++){var c=o[i[a].substr(1)-0-1];t.questionHtmlArr.push($("<p>").append($(c).clone()).html())}return t.answerInfo.questionInfo.paperId=$.cookie("PAPERID"),t.questionWrap=s,t.show(s),!1}return s.find(".item").each(function(e){t.questionHtmlArr.push($("<p>").append($(this).clone()).html())}),t.questionHtmlArr=t.resortArr(t.questionHtmlArr),s.html(""),t.questionWrap=s,t.show(s),t.answerInfo.questionInfo.paperId=e,!1}})},fillAnswers:function(){var e="",t="",n="",o=JSON.parse($.cookie("ANSWERS"));$(".list-question").each(function(i){var r=$(this);n=r.attr("data-paperid"),n===$.cookie("PAPERID")&&r.find(".item").each(function(n){e=$(this).data("questionid"),void 0!==o[e]&&(t=o[e].select,$(this).find("input").each(function(e){var n=$(this);n.val()===t?n.attr("checked","checked"):n.attr("checked",!1)}))})})},show:function(e){for(var t=this,n="",o="",i="",r="",s="",a=0;a<t.questionHtmlArr.length;a++)s=10>a+1?"0"+(a+1):a+1,i=$(t.questionHtmlArr[a]),i.find(".num").text(s),r=$("<p>").append(i.clone()).html(),n+=r,o=i.data("questionid"),t.answerInfo.questionInfo.questionsId.push(o),t.questionHtmlArr[a]=r;e.html(n),e.show(),$.cookie("ANSWERS")&&t.fillAnswers(),$(".list-question .item:odd").addClass("item-odd");var c=$(".time-bar").offset().top;$(window).scroll(function(){$(window).scrollTop()>0?$(".go-top").css("display","block"):$(".go-top").css("display","none"),$(window).scrollTop()>c?$(".time-bar").addClass("time-bar-fixed"):$(".time-bar").removeClass("time-bar-fixed")})},initStartTime:function(){var e=this;e.STARTTIME=(new Date).getTime(),$.cookie("STARTTIME",e.STARTTIME,{expires:e.EXPIRES})},getRandomPaperId:function(e){return"p"+parseInt(Math.random()*e+1,0)},loadPandora:function(e){if($.isPlainObject(window.pandora))e&&$.isFunction(e)&&e();else{var t=document,n=t.createElement("script");n.type="text/javascript",n.async=!0,n.src="http://ue.17173cdn.com/a/lib/pandora.js",n.onload=n.onreadystatechange=function(){n.readyState&&"loaded"!=n.readyState&&"complete"!=n.readyState||(n.onreadystatechange=n.onload=null,e&&$.isFunction(e)&&e())},document.body.appendChild(n)}},msgBox:function(e,t){var n=this,o=t;o&&n.loadPandora(function(){pandora.use([e],function(e){new e({title:o.title,content:o.content,width:"550px"})})})}};e.init(),e.loadPandora(function(){pandora.use(["floating"],function(e){new e({contentWidth:1e3,element:"#floating",vertical:"middle",horizontal:"right",offset:{x:40,y:0}})})})}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function t(e){return a.raw?e:encodeURIComponent(e)}function n(e){return a.raw?e:decodeURIComponent(e)}function o(e){return t(a.json?JSON.stringify(e):String(e))}function i(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(s," ")),a.json?JSON.parse(e):e}catch(t){}}function r(t,n){var o=a.raw?t:i(t);return e.isFunction(n)?n(o):o}var s=/\+/g,a=e.cookie=function(i,s,c){if(void 0!==s&&!e.isFunction(s)){if(c=e.extend({},a.defaults,c),"number"==typeof c.expires){var u=c.expires,f=c.expires=new Date;f.setTime(+f+864e5*u)}return document.cookie=[t(i),"=",o(s),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}for(var l=i?void 0:{},p=document.cookie?document.cookie.split("; "):[],d=0,I=p.length;I>d;d++){var h=p[d].split("="),m=n(h.shift()),$=h.join("=");if(i&&i===m){l=r($,s);break}i||void 0===($=r($))||(l[m]=$)}return l};a.defaults={},e.removeCookie=function(t,n){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}}),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function this_value(){return this.valueOf()}function quote(e){return rx_escapable.lastIndex=0,rx_escapable.test(e)?'"'+e.replace(rx_escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,o,i,r,s,a=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(r=c.length,n=0;r>n;n+=1)s[n]=str(n,c)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,i}if(rep&&"object"==typeof rep)for(r=rep.length,n=0;r>n;n+=1)"string"==typeof rep[n]&&(o=rep[n],i=str(o,c),i&&s.push(quote(o)+(gap?": ":":")+i));else for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(i=str(o,c),i&&s.push(quote(o)+(gap?": ":":")+i));return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,i}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,n){var o;if(gap="",indent="","number"==typeof n)for(o=0;n>o;o+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,o,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(o=walk(i,n),void 0!==o?i[n]=o:delete i[n]);return reviver.call(e,t,i)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),$(".form-radio-con .form-radio-txt").click(function(e){$(this).parent().find("input").attr("checked","checked")}),function(){var e=(parseInt($(window).height()),parseInt($(".layer-side").height()),parseInt($(".layer-ref").offset().top)),t=(parseInt($(".layer-ref").height()),parseInt($(".layer-side").position().top)),n=$(window).scrollTop();if(n>=e)var o=n-e+t,i=o;else var i=t;$(".layer-side").css("top",i+"px"),$(window).scroll(function(){var e=$(window).scrollTop();if(e>=t)var n=e-45,o=n;else var o=t;$(".layer-side").css("top",o+"px")})}();